import React from 'react';
import { Bookmark, ExternalLink, Share2, Plus } from 'lucide-react';
import type { Article } from '../types';

interface ArticleCardProps {
    article: Article;
    isSaved?: boolean;
    onToggleSave: (id: string) => void;
    onAddToList?: (id: string) => void;
}

export const ArticleCard: React.FC<ArticleCardProps> = ({
    article,
    isSaved = false,
    onToggleSave,
    onAddToList
}) => {
    // Select a Cyberpunk thumbnail based on category logic (simple hash)
    const getThumbnail = (cat: string) => {
        const lowerCat = cat.toLowerCase();
        if (lowerCat.includes('business') || lowerCat.includes('finance')) return '/assets/thumb-finance.png';
        if (lowerCat.includes('tech') || lowerCat.includes('science')) return '/assets/thumb-tech.png';
        return '/assets/thumb-city.png';
    };

    return (

        <article className="card flex flex-col h-full animate-in fade-in active:scale-[0.99] transition-all group overflow-hidden p-4 relative">
            {/* Header: Category, Source & Date */}
            <div className="flex justify-between items-start mb-2">
                <div className="flex items-center gap-2 text-[10px] text-[var(--color-primary)] uppercase tracking-wider font-mono">
                    <span className="px-1.5 py-0.5 rounded-sm text-[9px] uppercase font-bold tracking-wider bg-[var(--color-primary-dim)] text-[var(--color-primary)] border border-[var(--color-primary)]">
                        {article.category}
                    </span>
                    <span className="font-bold">{article.source}</span>
                    <span>//</span>
                    <time>{new Date(article.publishedAt).toLocaleDateString()}</time>
                </div>
                <div className="flex gap-2">
                    <button
                        onClick={(e) => {
                            e.preventDefault();
                            onToggleSave(article.id);
                        }}
                        className={`transition-colors ${isSaved ? 'text-[var(--color-secondary)]' : 'text-[var(--color-text-muted)] hover:text-[var(--color-primary)]'}`}
                    >
                        <Bookmark size={16} fill={isSaved ? "currentColor" : "none"} />
                    </button>
                </div>
            </div>

            {/* Main Content Area: Flex Row with Thumbnail LEFT */}
            <div className="flex gap-4">
                {/* Thumbnail (Left) - Icon Size */}
                <div
                    className="relative w-10 h-10 shrink-0 border border-[var(--color-border-glow)] overflow-hidden rounded-sm bg-black"
                    style={{ width: '40px', height: '40px' }}
                >
                    <img
                        src={article.imageUrl || getThumbnail(article.category)}
                        alt={article.title}
                        className="w-full h-full object-cover grayscale opacity-80 group-hover:opacity-100 group-hover:grayscale-0 transition-all"
                        onError={(e) => {
                            (e.target as HTMLImageElement).src = getThumbnail(article.category);
                        }}
                    />
                </div>

                {/* Text Content (Right) */}
                <div className="flex-1 flex flex-col">
                    <h3 className="text-lg font-bold leading-tight mb-2 line-clamp-2 group-hover:text-[var(--color-primary)] transition-colors font-display">
                        <a
                            href={article.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-[var(--color-text-primary)] hover:text-[var(--color-primary)] visited:text-[var(--color-text-visited)] transition-colors"
                        >
                            {article.title}
                        </a>
                    </h3>
                    <p className="text-[var(--color-text-secondary)] text-xs line-clamp-2 leading-relaxed mb-auto">
                        {article.summary}
                    </p>
                </div>
            </div>

            {/* Footer/Actions */}
            <div className="pt-3 mt-4 border-t border-[var(--color-border)]/50 flex items-center justify-between">
                <a
                    href={article.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="flex items-center gap-2 text-xs font-bold text-[var(--color-primary)] hover:text-[var(--color-accent)] uppercase tracking-widest"
                >
                    Read_Data <ExternalLink size={12} />
                </a>

                <div className="flex gap-1">
                    {onAddToList && (
                        <button
                            onClick={() => onAddToList(article.id)}
                            className="p-1.5 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] hover:bg-[var(--color-primary-dim)] rounded-sm transition-colors"
                            title="Add to list"
                        >
                            <Plus size={16} />
                        </button>
                    )}
                    <button
                        className="p-1.5 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] hover:bg-[var(--color-primary-dim)] rounded-sm transition-colors"
                        title="Share"
                    >
                        <Share2 size={16} />
                    </button>
                </div>
            </div>
        </article>
    );
};
